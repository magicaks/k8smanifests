---
---
# Source: azure-key-vault-env-injector/templates/rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  namespace: default
  name: akv2k8s-env-injector-azure-key-vault-env-injector
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector
roleRef:
  kind: ClusterRole
  apiGroup: rbac.authorization.k8s.io
  name: cluster-admin
subjects:
- kind: ServiceAccount
  namespace: default
  name: akv2k8s-env-injector-azure-key-vault-env-injector
---

apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector-reader
rules:
- apiGroups:
  - spv.no
  resources:
  - azurekeyvaultsecrets
  verbs:
  - get
  - list
  - watch
---

kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector-reader
subjects:
- kind: Group
  name: system:serviceaccounts
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: akv2k8s-env-injector-azure-key-vault-env-injector-reader
  apiGroup: rbac.authorization.k8s.io
---

# Source: azure-key-vault-env-injector/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector
  labels:
    app: akv2k8s-env-injector-azure-key-vault-env-injector
    chart: azure-key-vault-env-injector-0.1.5
    release: akv2k8s-env-injector
    heritage: Tiller
    component: mutating
spec:
  type: ClusterIP
  ports:
    - port: 443
      targetPort: 443
      protocol: TCP
      name: azure-keyvault-secrets-webhook
  selector:
    app: azure-key-vault-env-injector
    release: akv2k8s-env-injector

---

# Source: azure-key-vault-env-injector/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector
  labels:
    app: azure-key-vault-env-injector
    chart: azure-key-vault-env-injector-0.1.5
    release: akv2k8s-env-injector
    heritage: Tiller
    component: webhook
spec:
  replicas: 1
  selector:
    matchLabels:
      app: azure-key-vault-env-injector
      release: akv2k8s-env-injector
  template:
    metadata:
      labels:
        app: azure-key-vault-env-injector
        release: akv2k8s-env-injector
      annotations:
        checksum/config: fe23b6b5920ce7a22a9ccf8ee40fc55d52524c0ba430493813719d05cec39bdf
    spec:
      serviceAccountName: akv2k8s-env-injector-azure-key-vault-env-injector
      volumes:
      - name: serving-cert
        secret:
          defaultMode: 420
          secretName: akv2k8s-env-injector-azure-key-vault-env-injector
      - name: dockersock
        hostPath:
          path: /var/run/docker.sock
          type: File
      - name: azureconf
        hostPath:
          path: /etc/kubernetes/azure.json
          type: File
      containers:
        - name: azure-key-vault-env-injector
          image: "spvest/azure-keyvault-webhook:0.1.15"
          env:
          - name: TLS_CERT_FILE
            value: /var/serving-cert/servingCert
          - name: TLS_PRIVATE_KEY_FILE
            value: /var/serving-cert/servingKey
          - name: AZUREKEYVAULT_ENV_IMAGE
            value: spvest/azure-keyvault-env:0.1.15
          - name: AAD_POD_BINDING_LABEL
            valueFrom:
              fieldRef:
                fieldPath:  metadata.labels['aadpodidbinding']
          - name: DEBUG
            value: "false"
          imagePullPolicy: IfNotPresent
          ports:
          - containerPort: 443
          volumeMounts:
          - mountPath: /var/serving-cert
            name: serving-cert
          - mountPath: /var/run/docker.sock
            name: dockersock
            readOnly: true
          - mountPath: /etc/kubernetes/azure.json
            name: azureconf
            readOnly: true
          resources:
            {}
            

---

# Source: azure-key-vault-env-injector/templates/apiservice.yaml





apiVersion: v1
kind: List
metadata:
items:

- apiVersion: v1
  kind: Secret
  metadata:
    name: akv2k8s-env-injector-azure-key-vault-env-injector
  data:
    servingCert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKekNDQWcrZ0F3SUJBZ0lSQUl4aG5rZ2IzRG9Gd3YyKytvZWJjaFl3RFFZSktvWklodmNOQVFFTEJRQXcKRlRFVE1CRUdBMVVFQXhNS2MzWmpMV05oZEMxallUQWVGdzB5TURBeU1USXhNRE14TWpOYUZ3MHlNVEF5TVRFeApNRE14TWpOYU1FZ3hSakJFQmdOVkJBTVRQV0ZyZGpKck9ITXRaVzUyTFdsdWFtVmpkRzl5TFdGNmRYSmxMV3RsCmVTMTJZWFZzZEMxbGJuWXRhVzVxWldOMGIzSXVaR1ZtWVhWc2RDNXpkbU13Z2dFaU1BMEdDU3FHU0liM0RRRUIKQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUNtZ010bDdUc1Q3eGsyblNPeUlrZmZlZGdxdDB0SmtyRHgxZU9STjMvYQp5ai9JSmk4RytMcDhmK0NRV09rRHdGaklWRGtSNkhjN05PN3djNVhvU3ZudjUxdU9pL1ZOcEdvNjd0MWE4a3ZNCndtckFKd2psVVpWM29wdGNvQmRlWHZwdHNBbGhFclpraUVoTUNjNzkvTHhSb2VDZVBjU054aUhUcmFUTGdhS3kKc3E5emlNRC9OWlVveGJQNmx3dVc4ZFFWZzZER0xDMGRCVmhqQWRZaEdFM0h3Y2IyOUgva3pwMm9VQlprQUx1VgpaK0xIdFZoV3VKaWZLT2NyUTVOZGlJRWdoSlB6Z2lqbURGOXJ1TUZ0WC84M2N6NTRuQ3dFNmQwWXVybnlHRzhOCmplNTl3a096ZGIyd2lEMnR3cXBhM3dDVEo0OFpWNEZJU1Q1UmNLQ0NHalVUQWdNQkFBR2pQekE5TUE0R0ExVWQKRHdFQi93UUVBd0lGb0RBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEQVlEVlIwVApBUUgvQkFJd0FEQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFhSGpPNzNBb3V4VUJtMnNiVXFYSmJQS1dhOE9GClJFSjlUdDJqRklTVDJrS3VDMmg2VkVvN2lneFZzMWZiWk5LMk1hRTY1ZExabkdSV1Y2R1l4QXc2Tk9HN1NjSm8KdGh5RUtYL05GQzVTZWp6T3VWb1ExMlkyUk1PTTZSWkdYc0lESUpNYk9IdlJmaU56Sks0T1IzQnhRSXRvbUpmegpabm1sdmRpMHZaNU85Sy9BaVNHVXdNa0QzTTJGaVZEVnZMcDc5S3dmd0hXZ2hycS8vMjNaVmlNZTFvNC95OENECndybFowNjJyZ1ovRXNVQm5peXN3MVhVWHFXaXM5dWhmQ1hQb0pveC9zOFNNVUhkc0FEU0ZEMm9OQU1VRThHaHQKSmMyRHkzSW5odngwZnZ4THFtcXJWU3hzSVFZclpabHZHcSs1RzlWUFhTQkRBS3I2VXM3T1djWXFmdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    servingKey: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBcG9ETFplMDdFKzhaTnAwanNpSkgzM25ZS3JkTFNaS3c4ZFhqa1RkLzJzby95Q1l2CkJ2aTZmSC9na0ZqcEE4Qll5RlE1RWVoM096VHU4SE9WNkVyNTcrZGJqb3YxVGFScU91N2RXdkpMek1KcXdDY0kKNVZHVmQ2S2JYS0FYWGw3NmJiQUpZUksyWkloSVRBbk8vZnk4VWFIZ25qM0VqY1loMDYya3k0R2lzckt2YzRqQQoveldWS01XeitwY0xsdkhVRllPZ3hpd3RIUVZZWXdIV0lSaE54OEhHOXZSLzVNNmRxRkFXWkFDN2xXZml4N1ZZClZyaVlueWpuSzBPVFhZaUJJSVNUODRJbzVneGZhN2pCYlYvL04zTStlSndzQk9uZEdMcTU4aGh2RFkzdWZjSkQKczNXOXNJZzlyY0txV3Q4QWt5ZVBHVmVCU0VrK1VYQ2dnaG8xRXdJREFRQUJBb0lCQVFDYjJ2K0ozM0Juam01SgpndnBBNm5uZ3BFdEdZT0RtYzV1U0pDYXFiZ3NPSURkb0FPWVFYbzhocnduajFIWDVmdmtjUEVwWGl3VGd0UUhjCnJqVnFoWlJEam90VGVZc2JMSVlMdUVBWHU2cGNkcmc2T2MvSDZJQkN4a0VyaU9lVy9NenFFOWdUdDlKbmRISkkKU3Y0cEhZU2gzU2RHdUliZU50Sy9ORkdIOVViNGdXdXNNSFNDZUVsdkpwWjlBOE5uMkxweTRpeHQ2M3haWDZUTQppYjlGejlJRm5qZ3JzYmhCVERTRU15aHlCSWZvVHUvYWgvRGdBRGFxaTg0bHpLeDJ1enhMV2tpb3VGb0FtY2RICkhGUVZXVFlneE5pWXZ6N1dRUU5tSlVnczlVSDFoSSthUXVkYWc0Y3gyRWNFQ1RZUkZlZGgxL3hVZlNhdWJ6MXUKazg0d1J1b0JBb0dCQU5UYzZ6c0VFMXlsME4rUkxVLzhRY0hEcSt4R1UwRGdnRGREYWhsRXNIczZoZjYwckNRZApkMHN6ZGMzR01zL1NUekVYR2dyTmhaQXg5K1UrcWV4TldiMkw3ZWlsVC9lMXpVQzJmMUdiMDJqQ1NsblhZZEUzCmJuSkxVZ0xnV3dKWHNhWTBWZ1MzTG5CSGdiSlBUMzQzY0RuaEtFeDRoUkJrV25vRDNoMXd4N0dUQW9HQkFNZysKeDhqODdMMUVXaWNsK2JmUkZrMCtxMFBUbmhjS1BCdk9ZZ1BCTFE3cHZaK2EvRWkwSGp4THZicWNaZTNIUWZUZwowcXhqdnUrVHR3OUp1UHVXTUY3WlR0V092WmdWWmVlZzFpTmk1Q0hXY0JhR1JVeFZKZ3ZlZFJEbHU3b0FHdkN6CkNtZ0NUUHkvYjFubWVVWGlpSmEwemRWNzk4S0dlMURUdlRVYk81NkJBb0dBVGV6eVVKQ1ZaZjF1RWVwYjVFUTgKN21wcnJmdXd6cmRoT05uOUpYTDRDS1RNR1FxYldqMVBSc0I0Qi9UZTlTWFF4Ky9sSUw5TWZoVk00eWVsblZSVAozZ2d6K0U5TWp5cUhFWUc5Nm1wWllxaDkvNVhSd1gzQmVTWUp4L1BLWFhrdEYrTmcraWoxWHpWT1RiQ3JNVkdxClRBWVpjcVZNVVV2cnMyOW5DUEFZcXZFQ2dZQWxNenlNUXloNzFNbm13ZkJOVE1PVzRCQ1REaW90WDVKaEhBc3IKWldUSWczWGR3NzRnaDQyaVovTzhTamZKWDU0S0x3WVVUb2QzSEhzQ2xSQ1BkSXhSNG83NXI0WGJUZ1piYkk2NwpqakNSZExQb0MxT3VaWmNtMTFIcUxMT2VUMHl4OEtEN1I0b2ozakNDaEFWOWpTTVExRS8wM0EzZ0RubTBQMUhFCkh1WUpnUUtCZ0NMMk9SaHIza2F5UjhmMjRJYTgxT0djUHg0UUZoUVBTeTEyQXBna01QNURsVmltTEw3WUtCajUKbnZOOXIrN0ZHRnRzMFJlb1V6UFRiZXh0bDEwbnc2YjhqQlltTWJERTRNeWs5eW5iZEx4djN0cUVIRUdmSmNCUAoydEd5ZFM5bjhHNWNlU2NId3FXU0lqZjNFUUk0eWU2NDBQMXNhK2txbVBReDQwTWk1cG5tCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
    caCert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5ekNDQWQrZ0F3SUJBZ0lSQUk5V1AxVDFmVEo3YU1yK1NEMTNacjh3RFFZSktvWklodmNOQVFFTEJRQXcKRlRFVE1CRUdBMVVFQXhNS2MzWmpMV05oZEMxallUQWVGdzB5TURBeU1USXhNRE14TWpOYUZ3MHpNREF5TURreApNRE14TWpOYU1CVXhFekFSQmdOVkJBTVRDbk4yWXkxallYUXRZMkV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBCkE0SUJEd0F3Z2dFS0FvSUJBUURRSmlaQk8ySzlBdEFvMTY3eTNxUk9YQWRZcC9zR0d2UEc3MnpWRlFyeHJIdEgKMVkxWHUxaDJGVGtGamZEUmRjVVdKODZSdGE2eDQ5MHlWQ0w4b1JFbjBrYmxHV1RXTlJxcm4xVEg4eGtSOHBkUwpSRThZQ0xSeDBZSWxDZXJ2UW0zUElRRDdnbHhJTjgrcWFoSm1rQVJaNUJrazZXN2FCbGF5d296U0tUaFhocDcrCmpBL1Z5TWttTUQ2WVBWM0I3RVBwQUpFNTdlNjJhUWJZRDgrYWdhalJRalRzNk9tT1VKSE9aV0gzeVVVakdHeDcKY3N6UmlJbk5wVUNLR3ZJRm1lZDR5L28vaXlQQ2lLbEZ3cnZEdjQzak9mN2tnUXcyNEMyMUgzTGF2eUV1UkdzWApNdG91eFZxdnIvWTM0MHppaGpkU3E1N1RNU0pJN3lzcFVzR1ZqcVNsQWdNQkFBR2pRakJBTUE0R0ExVWREd0VCCi93UUVBd0lDcERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBcWpzUjJvQXV1VXE1U0xjQUREYTNjeDR4QUNhNApaNnIxQ2dVQWVMbU1OTjVuWkY0MkowZi9pU3pjYUZrcnZ2YmxvQzBZcjdmUTdXa2hQVnJVKy94aloxMkRnelpVCm9oVStkOXZRVW9KcFlRZ3l6WUZGVWNlL1N3d3NXSGdNSHRYUEhWWFhnQVJ3dEI0b3hiTk04Y1Z6ckE1TkNSNEYKZFFFd3V0Y1p1TUFYaGNxeGFqZjlqU2lZSXNiZmk5RW5naDFtQkZDWkc5cjhPZ0M3blU3VzJNbm15Mzc3SkRHOQpvTmQvQVZhUU5RblVrdVE3dlVXQTMrclJ3NVJBOTVMd2owK2Q1dnlGTjRjY0ZWazAyV0R4MFp0SGFCODhnVEdWCjZ1YlFnM3ZjNXVDYW9ZVjhHSVpRWUkzOTRvblRBUTZTTytSQWVaQ2lUWncxRTY3YWd4WjMzNUk2OFE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==

- apiVersion: admissionregistration.k8s.io/v1beta1
  kind: MutatingWebhookConfiguration
  metadata:
    name: akv2k8s-env-injector-azure-key-vault-env-injector
  webhooks:
  - name: pods.azure-key-vault-env-injector.admission.spv.no
    clientConfig:
      service:
        namespace: default
        name: akv2k8s-env-injector-azure-key-vault-env-injector
        path: /pods
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5ekNDQWQrZ0F3SUJBZ0lSQUk5V1AxVDFmVEo3YU1yK1NEMTNacjh3RFFZSktvWklodmNOQVFFTEJRQXcKRlRFVE1CRUdBMVVFQXhNS2MzWmpMV05oZEMxallUQWVGdzB5TURBeU1USXhNRE14TWpOYUZ3MHpNREF5TURreApNRE14TWpOYU1CVXhFekFSQmdOVkJBTVRDbk4yWXkxallYUXRZMkV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBCkE0SUJEd0F3Z2dFS0FvSUJBUURRSmlaQk8ySzlBdEFvMTY3eTNxUk9YQWRZcC9zR0d2UEc3MnpWRlFyeHJIdEgKMVkxWHUxaDJGVGtGamZEUmRjVVdKODZSdGE2eDQ5MHlWQ0w4b1JFbjBrYmxHV1RXTlJxcm4xVEg4eGtSOHBkUwpSRThZQ0xSeDBZSWxDZXJ2UW0zUElRRDdnbHhJTjgrcWFoSm1rQVJaNUJrazZXN2FCbGF5d296U0tUaFhocDcrCmpBL1Z5TWttTUQ2WVBWM0I3RVBwQUpFNTdlNjJhUWJZRDgrYWdhalJRalRzNk9tT1VKSE9aV0gzeVVVakdHeDcKY3N6UmlJbk5wVUNLR3ZJRm1lZDR5L28vaXlQQ2lLbEZ3cnZEdjQzak9mN2tnUXcyNEMyMUgzTGF2eUV1UkdzWApNdG91eFZxdnIvWTM0MHppaGpkU3E1N1RNU0pJN3lzcFVzR1ZqcVNsQWdNQkFBR2pRakJBTUE0R0ExVWREd0VCCi93UUVBd0lDcERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBcWpzUjJvQXV1VXE1U0xjQUREYTNjeDR4QUNhNApaNnIxQ2dVQWVMbU1OTjVuWkY0MkowZi9pU3pjYUZrcnZ2YmxvQzBZcjdmUTdXa2hQVnJVKy94aloxMkRnelpVCm9oVStkOXZRVW9KcFlRZ3l6WUZGVWNlL1N3d3NXSGdNSHRYUEhWWFhnQVJ3dEI0b3hiTk04Y1Z6ckE1TkNSNEYKZFFFd3V0Y1p1TUFYaGNxeGFqZjlqU2lZSXNiZmk5RW5naDFtQkZDWkc5cjhPZ0M3blU3VzJNbm15Mzc3SkRHOQpvTmQvQVZhUU5RblVrdVE3dlVXQTMrclJ3NVJBOTVMd2owK2Q1dnlGTjRjY0ZWazAyV0R4MFp0SGFCODhnVEdWCjZ1YlFnM3ZjNXVDYW9ZVjhHSVpRWUkzOTRvblRBUTZTTytSQWVaQ2lUWncxRTY3YWd4WjMzNUk2OFE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    rules:
    - operations:
      - CREATE
      apiGroups:
      - "*"
      apiVersions:
      - "*"
      resources:
      - pods
    failurePolicy: Fail
    namespaceSelector:
      matchLabels:
        azure-key-vault-env-injection: enabled
      # matchExpressions:
      # - key: name
      #   operator: NotIn
      #   values:
      #   - default


