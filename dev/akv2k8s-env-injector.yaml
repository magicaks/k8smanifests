---
---
# Source: azure-key-vault-env-injector/templates/rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  namespace: default
  name: akv2k8s-env-injector-azure-key-vault-env-injector
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector
roleRef:
  kind: ClusterRole
  apiGroup: rbac.authorization.k8s.io
  name: cluster-admin
subjects:
- kind: ServiceAccount
  namespace: default
  name: akv2k8s-env-injector-azure-key-vault-env-injector
---

apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector-reader
rules:
- apiGroups:
  - spv.no
  resources:
  - azurekeyvaultsecrets
  verbs:
  - get
  - list
  - watch
---

kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector-reader
subjects:
- kind: Group
  name: system:serviceaccounts
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: akv2k8s-env-injector-azure-key-vault-env-injector-reader
  apiGroup: rbac.authorization.k8s.io
---

# Source: azure-key-vault-env-injector/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector
  labels:
    app: akv2k8s-env-injector-azure-key-vault-env-injector
    chart: azure-key-vault-env-injector-0.1.5
    release: akv2k8s-env-injector
    heritage: Tiller
    component: mutating
spec:
  type: ClusterIP
  ports:
    - port: 443
      targetPort: 443
      protocol: TCP
      name: azure-keyvault-secrets-webhook
  selector:
    app: azure-key-vault-env-injector
    release: akv2k8s-env-injector

---

# Source: azure-key-vault-env-injector/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: akv2k8s-env-injector-azure-key-vault-env-injector
  labels:
    app: azure-key-vault-env-injector
    chart: azure-key-vault-env-injector-0.1.5
    release: akv2k8s-env-injector
    heritage: Tiller
    component: webhook
spec:
  replicas: 1
  selector:
    matchLabels:
      app: azure-key-vault-env-injector
      release: akv2k8s-env-injector
  template:
    metadata:
      labels:
        app: azure-key-vault-env-injector
        release: akv2k8s-env-injector
      annotations:
        checksum/config: 7e7b7431fc4323260e968b594a190dcc8739615cad78b21abe202365251795fb
    spec:
      serviceAccountName: akv2k8s-env-injector-azure-key-vault-env-injector
      volumes:
      - name: serving-cert
        secret:
          defaultMode: 420
          secretName: akv2k8s-env-injector-azure-key-vault-env-injector
      - name: dockersock
        hostPath:
          path: /var/run/docker.sock
          type: File
      - name: azureconf
        hostPath:
          path: /etc/kubernetes/azure.json
          type: File
      containers:
        - name: azure-key-vault-env-injector
          image: "spvest/azure-keyvault-webhook:0.1.15"
          env:
          - name: TLS_CERT_FILE
            value: /var/serving-cert/servingCert
          - name: TLS_PRIVATE_KEY_FILE
            value: /var/serving-cert/servingKey
          - name: AZUREKEYVAULT_ENV_IMAGE
            value: spvest/azure-keyvault-env:0.1.15
          - name: AAD_POD_BINDING_LABEL
            valueFrom:
              fieldRef:
                fieldPath:  metadata.labels['aadpodidbinding']
          - name: DEBUG
            value: "false"
          imagePullPolicy: IfNotPresent
          ports:
          - containerPort: 443
          volumeMounts:
          - mountPath: /var/serving-cert
            name: serving-cert
          - mountPath: /var/run/docker.sock
            name: dockersock
            readOnly: true
          - mountPath: /etc/kubernetes/azure.json
            name: azureconf
            readOnly: true
          resources:
            {}
            

---

# Source: azure-key-vault-env-injector/templates/apiservice.yaml





apiVersion: v1
kind: List
metadata:
items:

- apiVersion: v1
  kind: Secret
  metadata:
    name: akv2k8s-env-injector-azure-key-vault-env-injector
  data:
    servingCert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKakNDQWc2Z0F3SUJBZ0lRYkR4Wk9WaVpkSjR2UjU1a3prYmU0ekFOQmdrcWhraUc5dzBCQVFzRkFEQVYKTVJNd0VRWURWUVFERXdwemRtTXRZMkYwTFdOaE1CNFhEVEl3TURJeE1qRXdNRGsxTlZvWERUSXhNREl4TVRFdwpNRGsxTlZvd1NERkdNRVFHQTFVRUF4TTlZV3QyTW1zNGN5MWxibll0YVc1cVpXTjBiM0l0WVhwMWNtVXRhMlY1CkxYWmhkV3gwTFdWdWRpMXBibXBsWTNSdmNpNWtaV1poZFd4MExuTjJZekNDQVNJd0RRWUpLb1pJaHZjTkFRRUIKQlFBRGdnRVBBRENDQVFvQ2dnRUJBTUxOeE9BcFg0dnBJRVR2YmN2TlAwMXlYUDhCdHdWK24rVXFycGJmU0xYKwpZU2Y0VWxLZG5EM004Q2k5T2V0ZXJreWZoYzZyRzQ1VGo4K2RHMVB3cm1hQnZ0bk5NVDRZeUtjSVJ6djNZUXJECm4wRS9mWndSVEhsVnd1V0sxUXB6NFpDM0ZZa3NMRkU3VDRuVC9PQVI1QUtsTWlkOHRRdDFMNDVBRzNEMGkvL04KZW1KcGhzVmJZM05mbm1PVHhnS21PV1NwdjZSYVpFMnJWYmQyQ3FrTkpuNFRLZHhKYmRWMzdyTzRJRjQ1MVFXZgpMMEhweURKMmpzQjlZM0RUMWkzbU5kMlNVOVg1QlBSTDBPZkM4T2Y4ak5mN3FEVGNJVkRkR1RkWWdiYVRZaktUCjkvRFdoc3BibFJsRDBpbW5hb0JHSTF2NVdDdmlvMmRIZFgvOHYwTENSbGNDQXdFQUFhTS9NRDB3RGdZRFZSMFAKQVFIL0JBUURBZ1dnTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQkJnZ3JCZ0VGQlFjREFqQU1CZ05WSFJNQgpBZjhFQWpBQU1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQkpsOENaZi9paGUvSks2K0ZCdmY2RFdtR09Da2dQClF0dks4Ums1NWxWczYxTVNnU3ZoLzJBcEdGNXQxQ2ZNR0xEUUdqcDBGVlBHbE1TS0MyenpvbmJuZ0NWUTJwc1IKS0o0S2dQN3dBaDNxeG8zVktKbnA2MVB5MkhCL1ZvN1hvQVphakV6VXptSmIxRmwyb1lPMnFPNENEQXpqeCt0MgpZejViY1dDaHFWWHovOUlBU3I0Y0NWQm5UUllIaWw5OGFJK2FRMjlSNWpGSDJWb2s2SFB1VE0vMWZGOU1weGZyClo1RjNjcUdaM3ZCaGJxRjFxN05zU0NObXBlZVhJM2V3S0FBekJwSGd6UlpQUHM4a0VaZW5aTFlhbGVUYVpPa3oKS010RHdtV2FzbTJWcDUwVWIzMS9PTS83Mm02NHNudTlHYWxDZ1hXM0RoYjlPRFN0Wms2dnRNbDUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    servingKey: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBd3MzRTRDbGZpK2tnUk85dHk4MC9UWEpjL3dHM0JYNmY1U3F1bHQ5SXRmNWhKL2hTClVwMmNQY3p3S0wwNTYxNnVUSitGenFzYmpsT1B6NTBiVS9DdVpvRysyYzB4UGhqSXB3aEhPL2RoQ3NPZlFUOTkKbkJGTWVWWEM1WXJWQ25QaGtMY1ZpU3dzVVR0UGlkUDg0QkhrQXFVeUozeTFDM1V2amtBYmNQU0wvODE2WW1tRwp4VnRqYzErZVk1UEdBcVk1WkttL3BGcGtUYXRWdDNZS3FRMG1maE1wM0VsdDFYZnVzN2dnWGpuVkJaOHZRZW5JCk1uYU93SDFqY05QV0xlWTEzWkpUMWZrRTlFdlE1OEx3NS95TTEvdW9OTndoVU4wWk4xaUJ0cE5pTXBQMzhOYUcKeWx1VkdVUFNLYWRxZ0VZalcvbFlLK0tqWjBkMWYveS9Rc0pHVndJREFRQUJBb0lCQUhOODAvdms2MDBoMzB5ZQorV082Z1kzamYvaDZSc3ZPSHZNWWs3ckVFdkk2SmRVeFpYU3ZGY0tacmNNcE01NHpXbmY0bHJaSVFLVG5Lem4xCk5ROVZmNzhycWo2clpFY2hJRXZPSDVVUWVvcU1JT3pvdkFuN1EzQW5oTXphdXFSZ3dOZ3ZnbWY1TlNqUFZiOHIKV3g1bjNOb29uNHhEWlgydWNvd051M2NDczhEcFFNeUxySXljWGJMWlNUVnV2ZGwwYnVTRnI0bUpLSi85OVRQQQpBTTJQTnFSVU5BYzArQUNQYnJMemxMS2ZHZnZkY21zcGRNUXQ4WGxoVzkrTUN2N2U3VlBWUGw3U2JuQnRZSlIxCnR0REw2SnBVQ1Exd2FVKzU0NEdnUVk2cnJwZHhIMHFHMkZxWVhXbDhmNVlOb1FKcEdZNjErK2VZRUMyME1YaGIKaDYvcVp5a0NnWUVBK3doMjJ6WjR3NWVteWVEKytmL044VkhDUmR4LzUvdm5IQnkwU1pNZUNFS2tDdGloUGdFcQpWeEpEWnZac2ROaHNUV2pLeGhYbzJ6QTRNU2RZTVh3Qm9sT3FIbUlmOU11cFN5NW92ckVTemhZemkrN01INTVQCm9TSllXV254Vm1ib1QwVDlIMkJ6VU9JZWNkYXZDSzhHakJiS2haWTZoOWY3Y0g2ak1TSXdTSHNDZ1lFQXhxaDkKMWFCclFkaU5oVWxiVE13VkUwdjNtVE90UlhJYmxpS0lvejlNbnRGOEp0YlllM3lSaXRVYTA3dkpRcHk2RkNueApIZVNWR0xPZFRWSnplZCs3aldMZTFOYW9LK1lxdHpWQlg3SFB6dmJVNC9Za2FnbjYyMm5aRWhUNWd6TVNsOUFBCmVIYUZOd1RNN3JiSTNtMVc4VHJ5VzhNeGFvRGJyd0M1VDlvc2FOVUNnWUVBbXFZT1F1SDk1OUVuU1RzNUdWNkQKeXVUcFlBeUZKNjlDSTBsenI5ZllLcEtUYUxNb01vQ1pTdWJQYTBEb2M5dFliUi9mdThTSG5YREpUVTdGd0VaNgo0enZUazhBem02VlQrQ0x4R0hrUjhyQXV0VWc1ckVqbEdZbUZFQ0I2TXhaV2kyOGUyUk9jTnZuMmMzOGtlWjhKCjA0ZSs0Q2s2aWJGL0QwQ1UzSklKV0wwQ2dZRUFsSkhzVWZrQVhpVkxhZFE3ME1xTU5IdEsrQ3VhdVdZbVZYa00KUVRLVTVlMzdjTHlhK0hkb0RiRmt0OWNvSklZNzc5cVNOZTMreDVPRTRBLzZ4cm5aZFZydEZiWlgzVVRzeTBtcgowNXFTdE5FSzFGWUFVOEdVOThWSWoycGFWSkc4cFFidFl5b1laTlpWUVc0MytZbENUWFR0VGsxRHhzZ0tBKzZCCnFNT2RGT1VDZ1lBYXFMMThNTkxSWnYyRTNwQVo5QTBaTCtsRE9EWSsvcUVRdUE1QzNQdUR3cVo4aGRmYW42dGkKd3hpRmUrV01CbzZpcUNMbHp5WlVEYkFYSkp5NGpyUTlYbzVPMkNSd3NjcWdXNHRna1BJaEM4TnpNUEdLcnhnWAo0d1Z1UGxNV01nemdFQ24wUzVWQ1BRaGdkeFdIK0lHektmczhRV1VBMkhGQWltY0ZBU29RK1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
    caCert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5ekNDQWQrZ0F3SUJBZ0lSQU12VTYxNGQ3ekdDRzZVd2dvNkkwZkF3RFFZSktvWklodmNOQVFFTEJRQXcKRlRFVE1CRUdBMVVFQXhNS2MzWmpMV05oZEMxallUQWVGdzB5TURBeU1USXhNREE1TlRWYUZ3MHpNREF5TURreApNREE1TlRWYU1CVXhFekFSQmdOVkJBTVRDbk4yWXkxallYUXRZMkV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBCkE0SUJEd0F3Z2dFS0FvSUJBUURjTGlXUlgzcEpsUVJQY1RydlcwY1NkUXpHaDJpeUVqMnJBQUE3Q0JvcjdCUWkKckNNbGMzeitZRTBQcnBqZ3RBM0dDSmkyYUNTbmN5M2U5eXNwU1dHWVR1ZmRkcHNyaHJUamZzTThmdXY1S3lKawpmdno5ckVjWXMvZDlyNTFReVZwTVNPM1E1aWE3YzRubUNCdnAwVWU3SVBwdGlmOVduL1ZzWDlUaUp5U2pvL1NOCjdaMFhmR3BQT2ZpdFRRWVNEV1EyazhtNloydEQyVlQwZlhxZm9Rb0RlSDBveUhCWXRrb0NOb3I0M0JmWXNoQmoKaWxBcXYzOE9jMXpzRmRlNWM3bmw0V1lrU0hUTmo2aEpSVTNyeXh5SW5iTGRDMlFpM0ZxMnVUakpkTzVDd2IwSwoxTjFtZmJpTTJmYURsYWJjK1Y0WHhJbDJNNkZCNU11M1E2MnM5VExKQWdNQkFBR2pRakJBTUE0R0ExVWREd0VCCi93UUVBd0lDcERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBSVdLdjlCWmFXS3BDUFF0R29NT1crTlgrWCtWaQpFRmlYRkR3V1F1Y3VhZER5WGI4QjlwU2I1ZGxJNDV5UWhXK1VVUEE3MURtd0tsVDQ1b2NZQkZESmFidVR0S2dKCndSZk9rWjJVUU04UDRNU0ZOdkFWMHVvdEh3K2VkSDUrYUtUQU5tWm1NTTM3a25wQU9QckEvcE9JWDdiaGxCaU8KT2oyRFdRSkUwd3UvbWRucnM3SVRUa1F5RURHbzFMM2ZyMVUyMWxWQjNVbTViVWxUcFJwcUdEbmdtSXRRajM2UgpDT20vYm1PdjlJYVJTcXpGN0RjREV5bXdjNkk4RnNLR3VTYXo0bnp0SVVnTXl0aTMrbmtOK3FVNHNTNmhSb3BMCkpPc1J2eVo4czN4VThoanZhVEFUQlBwRmdFZmxDZ3RYOWdNU1F3eTQwdTlJNExkQVhiRUtpYWxWVmc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==

- apiVersion: admissionregistration.k8s.io/v1beta1
  kind: MutatingWebhookConfiguration
  metadata:
    name: akv2k8s-env-injector-azure-key-vault-env-injector
  webhooks:
  - name: pods.azure-key-vault-env-injector.admission.spv.no
    clientConfig:
      service:
        namespace: default
        name: akv2k8s-env-injector-azure-key-vault-env-injector
        path: /pods
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5ekNDQWQrZ0F3SUJBZ0lSQU12VTYxNGQ3ekdDRzZVd2dvNkkwZkF3RFFZSktvWklodmNOQVFFTEJRQXcKRlRFVE1CRUdBMVVFQXhNS2MzWmpMV05oZEMxallUQWVGdzB5TURBeU1USXhNREE1TlRWYUZ3MHpNREF5TURreApNREE1TlRWYU1CVXhFekFSQmdOVkJBTVRDbk4yWXkxallYUXRZMkV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBCkE0SUJEd0F3Z2dFS0FvSUJBUURjTGlXUlgzcEpsUVJQY1RydlcwY1NkUXpHaDJpeUVqMnJBQUE3Q0JvcjdCUWkKckNNbGMzeitZRTBQcnBqZ3RBM0dDSmkyYUNTbmN5M2U5eXNwU1dHWVR1ZmRkcHNyaHJUamZzTThmdXY1S3lKawpmdno5ckVjWXMvZDlyNTFReVZwTVNPM1E1aWE3YzRubUNCdnAwVWU3SVBwdGlmOVduL1ZzWDlUaUp5U2pvL1NOCjdaMFhmR3BQT2ZpdFRRWVNEV1EyazhtNloydEQyVlQwZlhxZm9Rb0RlSDBveUhCWXRrb0NOb3I0M0JmWXNoQmoKaWxBcXYzOE9jMXpzRmRlNWM3bmw0V1lrU0hUTmo2aEpSVTNyeXh5SW5iTGRDMlFpM0ZxMnVUakpkTzVDd2IwSwoxTjFtZmJpTTJmYURsYWJjK1Y0WHhJbDJNNkZCNU11M1E2MnM5VExKQWdNQkFBR2pRakJBTUE0R0ExVWREd0VCCi93UUVBd0lDcERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEd1lEVlIwVEFRSC8KQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBSVdLdjlCWmFXS3BDUFF0R29NT1crTlgrWCtWaQpFRmlYRkR3V1F1Y3VhZER5WGI4QjlwU2I1ZGxJNDV5UWhXK1VVUEE3MURtd0tsVDQ1b2NZQkZESmFidVR0S2dKCndSZk9rWjJVUU04UDRNU0ZOdkFWMHVvdEh3K2VkSDUrYUtUQU5tWm1NTTM3a25wQU9QckEvcE9JWDdiaGxCaU8KT2oyRFdRSkUwd3UvbWRucnM3SVRUa1F5RURHbzFMM2ZyMVUyMWxWQjNVbTViVWxUcFJwcUdEbmdtSXRRajM2UgpDT20vYm1PdjlJYVJTcXpGN0RjREV5bXdjNkk4RnNLR3VTYXo0bnp0SVVnTXl0aTMrbmtOK3FVNHNTNmhSb3BMCkpPc1J2eVo4czN4VThoanZhVEFUQlBwRmdFZmxDZ3RYOWdNU1F3eTQwdTlJNExkQVhiRUtpYWxWVmc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    rules:
    - operations:
      - CREATE
      apiGroups:
      - "*"
      apiVersions:
      - "*"
      resources:
      - pods
    failurePolicy: Fail
    namespaceSelector:
      matchLabels:
        azure-key-vault-env-injection: enabled
      # matchExpressions:
      # - key: name
      #   operator: NotIn
      #   values:
      #   - default


